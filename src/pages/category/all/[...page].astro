---
import Cards from "@/components/Cards.astro";
import CategoryTab from "@/components/CategoryTab.astro";
import Pagination from "@/components/Pagination.astro";
import Title from "@/components/Title.astro";
import Layout from "@/layouts/Layout.astro";
import { getCategories, getWorks } from "@/libs/microcms";
import type { GetStaticPathsOptions } from "astro";

export const getStaticPaths = async ({ paginate }: GetStaticPathsOptions) => {
  const works = await getWorks({
    fields: ["id", "title", "description", "images"],
    orders: "-createdAt",
    limit: 100,
  });

  return paginate(works.contents, { pageSize: 12 });
};

const categories = await getCategories({
  limit: 100,
});

const { page } = Astro.props;
---

<Layout title="all">
  <Title title="works" />
  <CategoryTab current="all" contents={categories.contents} />
  <Cards contents={page.data} />
  {
    page.lastPage > 1 && (
      <Pagination
        basePath="/category/all"
        currentPage={page.currentPage}
        lastPage={page.lastPage}
        previousPage={page.url.prev}
        nextPage={page.url.next}
      />
    )
  }
</Layout>
